<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q&A Website</title>
    <link rel="stylesheet" href="style.css">

    <!-- Include Firebase SDK -->
    <!-- These scripts import Firebase and Firestore libraries. -->
    <script src="https://www.gstatic.com/firebasejs/9.5.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.5.0/firebase-firestore.js"></script>
</head>

<body>
    <!-- Title of the page -->
    <h1>Ask a Question</h1>

    <!-- Form for submitting a new question -->
    <form id="questionForm">
        <!-- Input field for the question -->
        <input type="text" id="questionInput" placeholder="Type your question..." required>
        <!-- Submit button for the form -->
        <button type="submit">Submit</button>
    </form>

    <!-- Section for displaying previous questions and answers -->
    <h2>Previous Questions and Answers</h2>
    <div id="answeredQuestions"></div>

    <!-- JavaScript code for interacting with Firebase and Firestore -->
    <script>
        // Your Firebase project configuration
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-auth-domain",
            projectId: "your-project-id",
            storageBucket: "your-storage-bucket",
            messagingSenderId: "your-messaging-sender-id",
            appId: "your-app-id"
        };

        // Initialize Firebase and Firestore
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        /**
         * Function to load only answered questions from Firestore and display them on the page.
         * It orders the questions from most recent to least recent.
         */
        async function loadAnsweredQuestions() {
            // Get the div element where answered questions will be displayed
            const answeredQuestionsDiv = document.getElementById('answeredQuestions');
            // Clear any existing content in the div
            answeredQuestionsDiv.innerHTML = '';
            // Query Firestore for documents where 'answered' is true and order them by 'timestamp' in descending order
            const querySnapshot = await db.collection('questions')
                .where('answered', '==', true)
                .orderBy('timestamp', 'desc')
                .get();

            // Iterate over the query results and display each answered question
            querySnapshot.forEach((doc) => {
                // Get the data from the document
                const data = doc.data();
                // Create a div element to hold the question and answer
                const questionDiv = document.createElement('div');
                
                // Format the timestamp to a readable date and time
                const timestamp = data.timestamp.toDate();
                const formattedTime = timestamp.toLocaleString(); // Adjust the format as needed
                
                // Create the HTML content for the question and answer
                questionDiv.innerHTML = `
                    <p><strong>Question:</strong> ${data.question}</p>
                    <p><strong>Asked at:</strong> ${formattedTime}</p>
                    <p><strong>Answer:</strong> ${data.answer}</p>
                `;
                
                // Add the questionDiv to the answeredQuestionsDiv
                answeredQuestionsDiv.appendChild(questionDiv);
            });
        }

        /**
         * Handle form submission and save the question to Firestore.
         */
        document.getElementById('questionForm').addEventListener('submit', async (event) => {
            // Prevent the default form submission behavior
            event.preventDefault();
            // Get the question text from the input field
            const questionInput = document.getElementById('questionInput');
            const question = questionInput.value.trim();

            // If the question is not empty
            if (question) {
                // Add a new document to the `questions` collection with the provided question and default values for answer and answered
                await db.collection('questions').add({
                    question: question,
                    answer: '',
                    answered: false,
                    timestamp: firebase.firestore.Timestamp.now() // Set the current time as the timestamp
                });
                // Clear the input field
                questionInput.value = '';
            }
        });

        // Load answered questions when the page loads
        loadAnsweredQuestions();
    </script>
</body>
</html>
