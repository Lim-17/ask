<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q&A Website</title>

    <!-- Import Firebase and Firestore SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

        // Firebase configuration for your web app
        const firebaseConfig = {
            apiKey: "AIzaSyABK9kmYoExLI3qoLWU3KKPyudqD7QqmsE",
            authDomain: "questionanswer-7ad7c.firebaseapp.com",
            projectId: "questionanswer-7ad7c",
            storageBucket: "questionanswer-7ad7c.appspot.com",
            messagingSenderId: "827396179248",
            appId: "1:827396179248:web:513d2a182fe47c92b774f5"
        };

        // Initialize Firebase with your configuration
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
    </script>
</head>

<body>
    <!-- Title of the page -->
    <h1>Ask a Question</h1>

    <!-- Form for submitting a new question -->
    <form id="questionForm">
        <input type="text" id="questionInput" placeholder="Type your question..." required>
        <button type="submit">Submit</button>
    </form>

    <!-- Section for displaying previous questions and answers -->
    <h2>Previous Questions and Answers</h2>
    <div id="answeredQuestions"></div>

    <!-- JavaScript code for interacting with Firestore -->
    <script type="module">
        // Import necessary functions from Firebase Firestore SDK
        import { collection, addDoc, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

        // Define the Firestore database instance
        const db = getFirestore(app);

        /**
         * Function to load only answered questions from Firestore and display them on the page.
         * It orders the questions from most recent to least recent.
         */
        async function loadAnsweredQuestions() {
            // Get the div element where answered questions will be displayed
            const answeredQuestionsDiv = document.getElementById('answeredQuestions');
            // Clear any existing content in the div
            answeredQuestionsDiv.innerHTML = '';
            
            // Query Firestore for answered questions ordered by 'timestamp' in descending order (most recent to least recent)
            const questionsQuery = query(
                collection(db, 'questions'),
                where('answered', '==', true),
                orderBy('timestamp', 'desc')
            );
            
            // Get the query snapshot
            const querySnapshot = await getDocs(questionsQuery);
            
            // Iterate over the query results and display each answered question
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const questionDiv = document.createElement('div');
                
                // Format the timestamp to a readable date and time
                const timestamp = data.timestamp.toDate();
                const formattedTime = timestamp.toLocaleString();
                
                // Create the HTML content for the question and answer
                questionDiv.innerHTML = `
                    <p><strong>Question:</strong> ${data.question}</p>
                    <p><strong>Asked at:</strong> ${formattedTime}</p>
                    <p><strong>Answer:</strong> ${data.answer}</p>
                `;
                
                // Add the questionDiv to the answeredQuestionsDiv
                answeredQuestionsDiv.appendChild(questionDiv);
            });
        }

        /**
         * Handle form submission and save the question to Firestore.
         */
        document.getElementById('questionForm').addEventListener('submit', async (event) => {
            event.preventDefault(); // Prevent form submission

            // Get the question input
            const questionInput = document.getElementById('questionInput');
            const question = questionInput.value.trim();

            // Add a new question to Firestore
            if (question) {
                await addDoc(collection(db, 'questions'), {
                    question: question,
                    answer: '',
                    answered: false,
                    timestamp: firebase.firestore.Timestamp.now()
                });

                // Clear the input field
                questionInput.value = '';
            }
        });

        // Load answered questions when the page loads
        loadAnsweredQuestions();
    </script>
</body>

</html>
